<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galaxia de Amor con Saturno</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/FontLoader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/geometries/TextGeometry.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            overflow: hidden; 
            font-family: 'Arial', sans-serif; 
            background: radial-gradient(ellipse at bottom, #0a0e1a 0%, #000000 100%);
            color: white; 
            height: 100vh; 
            width: 100vw; 
            position: relative; 
        }
        h2{
            color: #ff69b4;
            font-size: 1.5rem;
        }
        .sky {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 2px white;
            animation: twinkle var(--duration) infinite alternate ease-in-out var(--delay);
            z-index: 0;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.5; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .moon {
            position: absolute;
            top: 10%;
            right: 5%;
            width: 150px;
            height: 150px;
            background: #f0f0f0;
            border-radius: 50%;
            box-shadow: 
                0 0 50px rgba(255, 255, 255, 0.4), 
                inset -15px -15px 40px rgba(0, 0, 0, 0.3),
                0 0 30px rgba(255, 255, 255, 0.3);
            z-index: 0;
            overflow: hidden;
            pointer-events: none;
        }

        #scene-container { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            z-index: 1; 
            background: transparent;
        }
        
        #ui-overlay { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            z-index: 10; 
            pointer-events: none; 
        }
        
        #instructions { 
            position: absolute; 
            bottom: 20px; 
            left: 0; 
            width: 100%; 
            text-align: center; 
            font-size: 16px; 
            padding: 12px; 
            animation: pulse 3s infinite; 
            background: rgba(0, 0, 0, 0.4); 
            backdrop-filter: blur(5px); 
        }
        
        @keyframes pulse { 
            0% { opacity: 0.7; } 
            50% { opacity: 1; } 
            100% { opacity: 0.7; } 
        }
        
        .heart { 
            position: absolute; 
            font-size: 22px; 
            color: #ff69b4; 
            z-index: 5; 
            pointer-events: none; 
            animation: fall linear forwards; 
            text-shadow: 0 0 8px #ff1493; 
        }
        
        @keyframes fall { 
            to { 
                transform: translateY(100vh) rotate(360deg); 
                opacity: 0; 
            } 
        }
        
        #touch-indicator { 
            position: absolute; 
            width: 60px; 
            height: 60px; 
            border-radius: 50%; 
            background: radial-gradient(circle, rgba(255,105,180,0.7) 0%, rgba(255,20,147,0) 70%); 
            pointer-events: none; 
            z-index: 20; 
            opacity: 0; 
            transform: translate(-50%, -50%); 
        }

        #loading { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            display: flex; 
            flex-direction: column;
            justify-content: center; 
            align-items: center; 
            font-size: 22px; 
            z-index: 100; 
            background: radial-gradient(circle at center, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            backdrop-filter: blur(5px);
            color: #fff;
        }
        
        .loading-content {
            background: rgba(0, 0, 0, 0.6);
            padding: 30px 50px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 0 30px rgba(100, 149, 237, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .clock-loader {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            position: relative;
            margin: 20px auto;
            background: conic-gradient(#ff69b4 0%, #ff69b4 var(--progress, 0%), #4a4a8a var(--progress, 0%), #4a4a8a 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.5);
        }

        .clock-loader::before {
            content: '';
            position: absolute;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: #1a1a2e;
        }

        .clock-hand {
            position: absolute;
            width: 3px;
            height: 30px;
            background: #ff69b4;
            top: 10px;
            left: 50%;
            transform-origin: bottom center;
            transform: translateX(-50%) rotate(0deg);
            box-shadow: 0 0 5px #ff69b4;
            z-index: 1;
            animation: clock-rotate 2s linear infinite;
        }

        @keyframes clock-rotate {
            0% { transform: translateX(-50%) rotate(0deg); }
            100% { transform: translateX(-50%) rotate(360deg); }
        }

        .clock-center {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ff69b4;
            z-index: 2;
            box-shadow: 0 0 10px #ff69b4;
        }

        .progress-text {
            margin-top: 10px;
            font-size: 18px;
            color: #ff69b4;
            text-shadow: 0 0 5px rgba(255, 105, 180, 0.7);
        }

        #loading-dots { animation: dots 1.5s infinite; }
        @keyframes dots { 0%, 20% { content: "."; } 40% { content: ".."; } 60%, 100% { content: "..."; } }

        .gallery { 
            position: absolute; 
            bottom: 80px; 
            left: 0; 
            width: 100%; 
            display: flex; 
            justify-content: center; 
            gap: 10px; 
            padding: 0 10px; 
            z-index: 15; 
            pointer-events: auto; 
        }
        
        .gallery-item { 
            width: 70px; 
            height: 70px; 
            border-radius: 10px; 
            overflow: hidden; 
            cursor: pointer; 
            border: 2px solid rgba(255, 255, 255, 0.3); 
            transition: all 0.3s ease; 
            background: rgba(0, 0, 0, 0.5); 
            backdrop-filter: blur(5px); 
        }
        
        .gallery-item:hover { 
            transform: scale(1.1); 
            border-color: #ff69b4; 
        }
        
        .gallery-item img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
        }
        
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0, 0, 0, 0.9); 
            z-index: 100; 
            justify-content: center; 
            align-items: center; 
        }
        
        .modal-content { 
            max-width: 90%; 
            max-height: 80%; 
            border-radius: 15px; 
            box-shadow: 0 0 50px rgba(255, 105, 180, 0.5); 
        }
        
        .modal-message { 
            position: absolute; 
            bottom: 50px; 
            left: 0; 
            width: 100%; 
            text-align: center; 
            font-size: 20px; 
            color: #ff69b4; 
            text-shadow: 0 0 10px #ff1493; 
            padding: 15px; 
            background: rgba(0, 0, 0, 0.7); 
            backdrop-filter: blur(10px); 
        }
        
        .close-btn { 
            position: absolute; 
            top: 20px; 
            right: 30px; 
            font-size: 40px; 
            color: white; 
            cursor: pointer; 
            z-index: 101; 
        }
        
        #audio-toggle { 
            position: absolute; 
            top: 15px; 
            right: 15px; 
            background: rgba(255, 255, 255, 0.15); 
            border: 1px solid rgba(255, 255, 255, 0.25); 
            color: white; 
            padding: 8px 12px; 
            border-radius: 20px; 
            cursor: pointer; 
            z-index: 15; 
            font-size: 14px; 
            backdrop-filter: blur(10px); 
            pointer-events: auto; 
            transition: all 0.3s ease; 
            opacity: 0.8; 
        }
        
        #audio-toggle:hover { 
            opacity: 1; 
            background: rgba(255, 255, 255, 0.25); 
        }
        
        @media (max-width: 768px) { 
            .gallery { bottom: 70px; gap: 5px; }
            .gallery-item { width: 60px; height: 60px; }
            #instructions { font-size: 14px; padding: 10px; }
            .modal-content { max-width: 95%; max-height: 70%; }
            .modal-message { font-size: 18px; bottom: 30px; }
            .moon { width: 100px; height: 100px; }
        }
        
        @media (max-width: 480px) {
            .gallery { bottom: 60px; }
            .gallery-item { width: 50px; height: 50px; }
            .modal-message { font-size: 16px; padding: 10px; }
            .moon { width: 70px; height: 70px; }
        }
    </style>
</head>
<body>
    <div class="sky" id="star-sky">
        <div class="moon"></div>
    </div>

    <div id="loading">
        <div class="loading-content">
           <h2> Cargando todo para ti, mi amor</h2><span id="loading-dots">...</span>
            <div class="clock-loader" id="clock-loader">
                <div class="clock-hand"></div>
                <div class="clock-center"></div>
            </div>
            <div class="progress-text" id="progress-text">0%</div>
        </div>
    </div>
    
    <div id="scene-container"></div>
    
    <div id="ui-overlay">
        <button id="audio-toggle">🔇 Audio OFF</button>
        <div id="touch-indicator"></div>
        <div id="instructions">Toca la pantalla para una lluvia de amor ❤️ (Toca para activar el Audio 🎧)</div>
        <div class="gallery">
            <div class="gallery-item" data-index="0"><img src="https://bcodestorague.anteroteobaldob.workers.dev/share/anteroteobaldob_gmail_com/GIF/gatito.gif" alt="Amor 1"></div>
            <div class="gallery-item" data-index="1"><img src="https://bcodestorague.anteroteobaldob.workers.dev/share/anteroteobaldob_gmail_com/GIF/img.gif" alt="Amor 2"></div>
            <div class="gallery-item" data-index="2"><img src="https://bcodestorague.anteroteobaldob.workers.dev/share/anteroteobaldob_gmail_com/GIF/Gatitosi.gif" alt="Amor 3"></div>
            <div class="gallery-item" data-index="3"><img src="https://bcodestorague.anteroteobaldob.workers.dev/share/anteroteobaldob_gmail_com/GIF/Gatito1.gif" alt="Amor 4"></div>
        </div>
    </div>

    <div id="image-modal" class="modal">
        <span class="close-btn">&times;</span>
        <img class="modal-content" id="modal-image">
        <div class="modal-message" id="modal-message"></div>
    </div>

    <audio id="background-audio" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    </audio>

    <script>
        let scene, camera, renderer, saturn, controls, font;
        let heartRainActive = false, touchCount = 0;
        let messageObjects = [];
        let ringTextObjects = [];
        let audioEnabled = false;
        let audioPlayed = false;
        
        const textureLoader = new THREE.TextureLoader();
        const fontLoader = new THREE.FontLoader();
        
        const SATURN_TEXTURE_URL = 'https://bcodestorague.anteroteobaldob.workers.dev/share/anteroteobaldob_gmail_com/TEXTURAS/textura_sat.jpg';
        
        const ringText = "TE AMO CON TODO MI CORAZÓN Y ALMA PARA SIEMPRE MI AMOR ETERNO";
        
        const loveMessages = [
            "TE AMO", "TE QUIERO", "ERES MI TODO", "MI AMOR", "ERES ESPECIAL", 
            "PARA SIEMPRE", "MI VIDA", "MI CORAZÓN", "MI ALMA", "MI REY/REINA",
            "MI RAZÓN DE SER", "MI FELICIDAD", "MI INSPIRACIÓN", "MI SUEÑO", 
            "MI DESEO", "MI PASIÓN", "MI TESORO", "MI ÁNGEL", "MI LUZ", 
            "MI SOL", "MI ESTRELLA", "MI UNIVERSO", "MI DESTINO", "MI SUERTE",
            "MI COMPAÑERO", "MI MEJOR AMIGO", "MI CONFIANZA", "MI APOYO",
            "MI REFUGIO", "MI PAZ", "MI CALMA", "MI FUERZA", "MI DEBILIDAD",
            "MI SONRISA", "MI RISITA", "MI LOCURA", "MI SERENIDAD", "MI EQUILIBRIO",
            "MI COMPLEMENTO", "MI MEDIA NARANJA", "MI ALMA GEMELA", "MI TODO",
            "MI ETERNA", "MI INFINITO", "MI PRESENTE", "MI FUTURO", "MI PASADO",
            "MI HOY", "MI MAÑANA", "MI SIEMPRE", "MI NUNCA", "MI AHORA"
        ];
        
        const imageMessages = [
            "Eres la luz que ilumina mi vida cada día",
            "Cada momento a tu lado es un regalo del universo",
            "Tu sonrisa es mi mayor tesoro",
            "Contigo he encontrado el amor verdadero"
        ];
        
        function createCSSStars(count) {
            const sky = document.getElementById('star-sky');
            for (let i = 0; i < count; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                const size = Math.random() * 2 + 1;
                star.style.width = size + 'px';
                star.style.height = size + 'px';
                star.style.left = Math.random() * 100 + 'vw';
                star.style.top = Math.random() * 100 + 'vh';
                star.style.setProperty('--delay', Math.random() * 5 + 's');
                star.style.setProperty('--duration', (Math.random() * 4 + 2) + 's');
                sky.appendChild(star);
            }
        }
        
        function loadResources() {
            return Promise.all([
                new Promise((resolve) => {
                    // Usar una fuente que soporte mejor los caracteres en español
                    fontLoader.load(
                        'https://threejs.org/examples/fonts/gentilis_regular.typeface.json',
                        (loadedFont) => {
                            font = loadedFont;
                            resolve();
                        },
                        undefined,
                        (error) => {
                            console.error('Error cargando la fuente:', error);
                            resolve();
                        }
                    );
                })
            ]);
        }

        function simulateLoading() {
            const clockLoader = document.getElementById('clock-loader');
            const progressText = document.getElementById('progress-text');
            let progress = 0;
            
            const interval = setInterval(() => {
                progress += 1;
                if (progress <= 100) {
                    clockLoader.style.setProperty('--progress', progress + '%');
                    progressText.textContent = progress + '%';
                } else {
                    clearInterval(interval);
                }
            }, 30);
        }
        
        function init() {
    simulateLoading();
    
    setTimeout(() => {
        document.getElementById('loading').style.display = 'none';
        
        scene = new THREE.Scene();
        scene.background = null;
        
        camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 8, 30);
        
        renderer = new THREE.WebGLRenderer({ 
            antialias: true, 
            alpha: true,
            powerPreference: "high-performance" 
        });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.2;
        renderer.setClearColor(0x000000, 0);
        
        document.getElementById('scene-container').appendChild(renderer.domElement);
        
        createUFO();
        
        controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.rotateSpeed = 0.5;
        controls.enableZoom = true;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 0.2;
        controls.minDistance = 20;
        controls.maxDistance = 60;
        
        controls.addEventListener('change', handleCameraMove);
        
        const ambientLight = new THREE.AmbientLight(0x444477, 0.4);
        scene.add(ambientLight);
        
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
        directionalLight.position.set(10, 10, 5);
        directionalLight.castShadow = true;
        scene.add(directionalLight);
        
        const pointLight = new THREE.PointLight(0xff69b4, 0.6, 50);
        pointLight.position.set(0, 0, 10);
        scene.add(pointLight);
        
        const backLight = new THREE.DirectionalLight(0x4466aa, 0.6);
        backLight.position.set(-5, -5, -5);
        scene.add(backLight);
        
        createSaturn();
        createTextRing();
        createStarField();
        createLoveMessages();
        createFloatingParticles();
        
        setupEventListeners();
        
        animate();
        
        setTimeout(() => {
            startUFOMission();
        }, 10000);
    }, 3500);
}
        function createSaturn() {
            const geometry = new THREE.SphereGeometry(4, 128, 128);
            const tempMaterial = new THREE.MeshPhongMaterial({ color: 0xddaa77, shininess: 10 });
            
            saturn = new THREE.Mesh(geometry, tempMaterial);
            saturn.castShadow = true;
            saturn.receiveShadow = true;
            scene.add(saturn);
            
            textureLoader.load(SATURN_TEXTURE_URL, 
                (texture) => {
                    texture.anisotropy = renderer.capabilities.getMaxAnisotropy();
                    const material = new THREE.MeshPhongMaterial({ 
                        map: texture, bumpScale: 0.05, specular: new THREE.Color(0x333333), shininess: 15
                    });
                    saturn.material = material;
                },
                undefined,
                (error) => {
                    console.error('Error cargando textura de Saturno:', error);
                }
            );
            
            const atmosphereGeometry = new THREE.SphereGeometry(4.15, 64, 64);
            const atmosphereMaterial = new THREE.MeshPhongMaterial({
                color: 0x88aaff, transparent: true, opacity: 0.08, side: THREE.BackSide
            });
            const atmosphere = new THREE.Mesh(atmosphereGeometry, atmosphereMaterial);
            saturn.add(atmosphere);
        }
        
        function createTextRing() {
            const radius = 7;
            const totalLetters = ringText.length;
            const angleStep = (Math.PI * 2) / totalLetters;
            
            const innerRingGeometry = new THREE.RingGeometry(4.8, 5.2, 64);
            const innerRingMaterial = new THREE.MeshPhongMaterial({
                color: 0xffccff,
                side: THREE.DoubleSide,
                transparent: true,
                opacity: 0.3,
                emissive: 0x330022
            });
            const innerRing = new THREE.Mesh(innerRingGeometry, innerRingMaterial);
            innerRing.rotation.x = Math.PI / 2 + 0.1;
            scene.add(innerRing);
            
            const outerRingGeometry = new THREE.RingGeometry(8.8, 9.2, 64);
            const outerRingMaterial = new THREE.MeshPhongMaterial({
                color: 0xffccff,
                side: THREE.DoubleSide,
                transparent: true,
                opacity: 0.3,
                emissive: 0x330022
            });
            const outerRing = new THREE.Mesh(outerRingGeometry, outerRingMaterial);
            outerRing.rotation.x = Math.PI / 2 + 0.1;
            scene.add(outerRing);
            
            if (font) {
                for (let i = 0; i < totalLetters; i++) {
                    const letter = ringText[i];
                    
                    const textGeometry = new THREE.TextGeometry(letter, {
                        font: font,
                        size: 0.4,
                        height: 0.05,
                        curveSegments: 12,
                        bevelEnabled: true,
                        bevelThickness: 0.01,
                        bevelSize: 0.02,
                        bevelSegments: 3
                    });
                    
                    const textMaterial = new THREE.MeshPhongMaterial({
                        color: 0xffccff,
                        emissive: 0x550044,
                        specular: 0xffaaff,
                        shininess: 100,
                        transparent: true,
                        opacity: 0.9
                    });
                    
                    const textMesh = new THREE.Mesh(textGeometry, textMaterial);
                    
                    const angle = -i * angleStep;
                    textMesh.position.x = Math.cos(angle) * radius;
                    textMesh.position.z = Math.sin(angle) * radius;
                    textMesh.position.y = 0;
                    
                    textMesh.rotation.y = angle + Math.PI;
                    textMesh.rotation.x = Math.PI / 2;
                    
                    scene.add(textMesh);
                    ringTextObjects.push(textMesh);
                }
            } else {
                createFallbackRing();
            }
        }
        function createFallbackRing() {
            const radius = 7;
            const totalSpheres = ringText.length * 2;
            const angleStep = (Math.PI * 2) / totalSpheres;
            
            for (let i = 0; i < totalSpheres; i++) {
                const sphereGeometry = new THREE.SphereGeometry(0.1, 8, 8);
                const sphereMaterial = new THREE.MeshPhongMaterial({
                    color: 0xffccff,
                    emissive: 0x550044,
                    transparent: true,
                    opacity: 0.9
                });
                
                const sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
                
                const angle = i * angleStep;
                sphere.position.x = Math.cos(angle) * radius;
                sphere.position.z = Math.sin(angle) * radius;
                sphere.position.y = 0;
                
                scene.add(sphere);
                ringTextObjects.push(sphere);
            }
        }
        
        function createStarField() {
            const starGeometry = new THREE.BufferGeometry();
            const starMaterial = new THREE.PointsMaterial({
                color: 0xffffff, size: 0.2, transparent: true, sizeAttenuation: true
            });
            
            const starVertices = [];
            for (let i = 0; i < 10000; i++) {
                starVertices.push((Math.random() - 0.5) * 2000, (Math.random() - 0.5) * 2000, (Math.random() - 0.5) * 2000);
            }
            
            starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
            const starField = new THREE.Points(starGeometry, starMaterial);
            scene.add(starField);
        }
        
        function createLoveMessages() {
            const shuffledMessages = [...loveMessages].sort(() => Math.random() - 0.5);
            const messagesToUse = shuffledMessages.slice(0, 50);
            
            messagesToUse.forEach((message, i) => {
                let textMesh;
                
                if (font) {
                    const textGeometry = new THREE.TextGeometry(message, {
                        font: font, 
                        size: 0.4, 
                        height: 0.1, 
                        curveSegments: 8,
                        bevelEnabled: true, 
                        bevelThickness: 0.02, 
                        bevelSize: 0.03, 
                        bevelSegments: 3
                    });
                    
                    textGeometry.computeBoundingBox();
                    textGeometry.center();
                    
                    textMesh = new THREE.Mesh(textGeometry, createTextMaterial());
                } else {
                    textMesh = createFallbackText(message);
                }
                
                const distance = 10 + Math.random() * 8;
                const angle = Math.random() * Math.PI * 2;
                const height = (Math.random() - 0.5) * 10;
                
                textMesh.position.set(Math.cos(angle) * distance, height, Math.sin(angle) * distance);
                
                scene.add(textMesh);
                messageObjects.push({
                    mesh: textMesh,
                    originalY: height,
                    speed: 0.2 + Math.random() * 0.3,
                    angle: angle,
                    distance: distance
                });
            });
        }

        function createTextMaterial() {
            return new THREE.MeshStandardMaterial({
                color: 0xff69b4, 
                emissive: 0x550033,
                emissiveIntensity: 0.8,
                metalness: 0.3,
                roughness: 0.7,
                transparent: true, 
                opacity: 0.9
            });
        }
            
        
        function createFallbackText(message) {
            const group = new THREE.Group();
            
            for (let i = 0; i < message.length; i++) {
                const sphereGeometry = new THREE.SphereGeometry(0.1, 6, 6);
                const sphereMaterial = createTextMaterial();
                const sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
                sphere.position.x = i * 0.3;
                group.add(sphere);
            }
            
            return group;
        }
        
        function createFloatingParticles() {
            const particleGeometry = new THREE.BufferGeometry();
            const particleCount = 1500;
            
            const positions = new Float32Array(particleCount * 3);
            const colors = new Float32Array(particleCount * 3);
            
            for (let i = 0; i < particleCount * 3; i += 3) {
                positions[i] = (Math.random() - 0.5) * 200;
                positions[i + 1] = (Math.random() - 0.5) * 200;
                positions[i + 2] = (Math.random() - 0.5) * 200;
                
                colors[i] = Math.random() * 0.5 + 0.5;
                colors[i + 1] = Math.random() * 0.3 + 0.3;
                colors[i + 2] = Math.random() * 0.7 + 0.3;
            }
            
            particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            particleGeometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
            
            const particleMaterial = new THREE.PointsMaterial({
                size: 0.1, 
                vertexColors: true, 
                transparent: true, 
                opacity: 0.7
            });
            
            const particles = new THREE.Points(particleGeometry, particleMaterial);
            scene.add(particles);
        }
        
        function setupEventListeners() {
            document.addEventListener('click', handleInteraction);
            document.addEventListener('touchstart', handleInteraction);
            
            document.addEventListener('click', showTouchEffect);
            document.addEventListener('touchstart', showTouchEffect);
            
            document.querySelectorAll('.gallery-item').forEach(item => {
                item.addEventListener('click', openModal);
            });
            
            document.querySelector('.close-btn').addEventListener('click', closeModal);
            
            document.getElementById('audio-toggle').addEventListener('click', toggleAudio);
            
            window.addEventListener('resize', onWindowResize);
            window.addEventListener('wheel', handleScroll);
        }
        
        function handleCameraMove() {
            if (audioEnabled && !audioPlayed) {
                playAudio();
            }
        }
        
        function handleScroll() {
            if (audioEnabled && !audioPlayed) {
                playAudio();
            }
        }
        
        function toggleAudio() {
            audioEnabled = !audioEnabled;
            const audioButton = document.getElementById('audio-toggle');
            
            if (audioEnabled) {
                audioButton.textContent = '🔊 Audio ON';
                audioButton.style.background = 'rgba(255, 105, 180, 0.3)';
                playAudio();
            } else {
                audioButton.textContent = '🔇 Audio OFF';
                audioButton.style.background = 'rgba(255, 255, 255, 0.15)';
                pauseAudio();
            }
        }
        
        function playAudio() {
            const audio = document.getElementById('background-audio');
            if (audioEnabled) {
                audio.play().then(() => {
                    audioPlayed = true;
                }).catch(e => {
                    console.log("Audio requiere interacción del usuario primero para reproducirse.");
                });
            }
        }
        
        function pauseAudio() {
            const audio = document.getElementById('background-audio');
            audio.pause();
        }
        
        function handleInteraction(e) {
            if (e.target.closest('.gallery-item') || e.target.closest('.modal') || e.target.closest('#audio-toggle') || document.getElementById('loading').style.display !== 'none') return;
            
            if (!audioPlayed) {
                audioEnabled = true;
                document.getElementById('audio-toggle').textContent = '🔊 Audio ON';
                document.getElementById('audio-toggle').style.background = 'rgba(255, 105, 180, 0.3)';
                playAudio();
            }
            
            createTextBurst(e);
            createHeartRain();
            
            touchCount++;
            if (touchCount === 5) {
                document.getElementById('instructions').textContent = "¡Eres increíble! Cada toque es un latido de mi corazón ❤️";
            } else if (touchCount === 10) {
                document.getElementById('instructions').textContent = "Eres el amor de mi vida 💖";
            } else if (touchCount >= 15) {
                const messages = ["Mi corazón late por ti", "Eres mi sueño hecho realidad", "Eres mi todo", "Te amo más cada día", "Eres mi razón de ser"];
                document.getElementById('instructions').textContent = messages[Math.floor(Math.random() * messages.length)];
            }
        }

        function createTextBurst(e) {
            const x = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
            const y = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;
            
            const loveTexts = ["TE AMO", "ERES MÍA", "MI AMOR", "PARA SIEMPRE", "MI VIDA", "MI TODO", "MI CORAZÓN", "MI ALMA"];
            const randomText = loveTexts[Math.floor(Math.random() * loveTexts.length)];
            
            const textBurst = document.createElement('div');
            textBurst.innerHTML = randomText;
            textBurst.style.position = 'absolute';
            textBurst.style.left = x + 'px';
            textBurst.style.top = y + 'px';
            textBurst.style.fontSize = '24px';
            textBurst.style.color = '#ff69b4';
            textBurst.style.fontWeight = 'bold';
            textBurst.style.textShadow = '0 0 10px #ff1493';
            textBurst.style.zIndex = '20';
            textBurst.style.pointerEvents = 'none';
            textBurst.style.transform = 'translate(-50%, -50%)';
            textBurst.style.animation = 'textBurstAnimation 1.5s ease-out forwards';
            
            document.getElementById('ui-overlay').appendChild(textBurst);
            
            setTimeout(() => {
                if (textBurst.parentNode) textBurst.parentNode.removeChild(textBurst);
            }, 1500);
        }

        const style = document.createElement('style');
        style.textContent = `
            @keyframes textBurstAnimation {
                0% {
                    opacity: 1;
                    transform: translate(-50%, -50%) scale(1);
                }
                100% {
                    opacity: 0;
                    transform: translate(-50%, -50%) scale(3);
                }
            }
        `;
        document.head.appendChild(style);
        function showTouchEffect(e) {
            if (e.target.closest('.gallery-item') || e.target.closest('.modal') || e.target.closest('#audio-toggle') || document.getElementById('loading').style.display !== 'none') return;
            
            const indicator = document.getElementById('touch-indicator');
            const x = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
            const y = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;
            
            indicator.style.left = x + 'px';
            indicator.style.top = y + 'px';
            indicator.style.opacity = '1';
            
            setTimeout(() => { indicator.style.opacity = '0'; }, 300);
        }
        
        function createHeartRain() {
            if (heartRainActive) return;
            
            heartRainActive = true;
            
            for (let i = 0; i < 25; i++) {
                setTimeout(() => createHeart(), i * 80);
            }
            
            create3DHearts();
            
            setTimeout(() => { heartRainActive = false; }, 3000);
        }
        
        function createHeart() {
            const heart = document.createElement('div');
            heart.innerHTML = '❤️';
            heart.classList.add('heart');
            heart.style.left = Math.random() * 100 + 'vw';
            heart.style.fontSize = (Math.random() * 20 + 18) + 'px';
            heart.style.animationDuration = (Math.random() * 2 + 2) + 's';
            
            document.getElementById('ui-overlay').appendChild(heart);
            
            setTimeout(() => {
                if (heart.parentNode) heart.parentNode.removeChild(heart);
            }, 5000);
        }
        let ufo, ufoActive = false, ufoTargetMessage = null;

        function createUFO() {
            const ufoGroup = new THREE.Group();
            
            const ufoBody = new THREE.Mesh(
                new THREE.SphereGeometry(1.5, 32, 32),
                new THREE.MeshPhongMaterial({
                    color: 0xff69b4,
                    emissive: 0x550033,
                    shininess: 100,
                    transparent: true,
                    opacity: 0.9
                })
            );
            ufoBody.scale.y = 0.2;
            ufoGroup.add(ufoBody);
            
            const ufoDome = new THREE.Mesh(
                new THREE.SphereGeometry(1.0, 32, 32),
                new THREE.MeshPhongMaterial({
                    color: 0xffb6c1,
                    emissive: 0x552233,
                    transparent: true,
                    opacity: 0.8
                })
            );
            ufoDome.position.y = 0.3;
            ufoDome.scale.y = 0.3;
            ufoGroup.add(ufoDome);
            
            const lightRing = new THREE.Mesh(
                new THREE.TorusGeometry(2.0, 0.1, 16, 32),
                new THREE.MeshPhongMaterial({
                    color: 0xff1493,
                    emissive: 0x330022,
                    transparent: true,
                    opacity: 0.9
                })
            );
            lightRing.rotation.x = Math.PI / 2;
            ufoGroup.add(lightRing);
            
            const ufoLight = new THREE.PointLight(0xff69b4, 3, 12);
            ufoGroup.add(ufoLight);
            
            for (let i = 0; i < 8; i++) {
                const angle = (i / 8) * Math.PI * 2;
                const light = new THREE.PointLight(0xff1493, 1, 4);
                light.position.set(
                    Math.cos(angle) * 1.8,
                    -0.2,
                    Math.sin(angle) * 1.8
                );
                ufoGroup.add(light);
            }

            const tractorBeam = new THREE.Mesh(
                new THREE.ConeGeometry(0.6, 2, 8), // tamaño rayo de 4 a 2
                new THREE.MeshBasicMaterial({
                    transparent: true,
                    opacity: 0,
                    color: 0xff69b4
                })
            );
            tractorBeam.position.y = -1.5; 
            tractorBeam.rotation.x = Math.PI;
            ufoGroup.add(tractorBeam);
            
            ufoGroup.position.set(0, 25, 0);
            ufoGroup.userData = { tractorBeam, light: ufoLight, stolenMessage: null };
            scene.add(ufoGroup);
            
            ufo = ufoGroup;
        }

        
        function startUFOMission() {
            if (ufoActive || messageObjects.length === 0) return;
            
            ufoActive = true;
            ufoTargetMessage = messageObjects[Math.floor(Math.random() * messageObjects.length)];
            
            ufo.position.set(
                (Math.random() - 0.5) * 50,
                20,
                (Math.random() - 0.5) * 50
            );
            
            if (!ufo.parent) {
                scene.add(ufo);
            }
            
            animateUFO();
        }

        function animateUFO() {
            if (!ufoTargetMessage) return;
            
            const targetPosition = ufoTargetMessage.mesh.position.clone();
            targetPosition.y += 2;
            const ufoPosition = ufo.position.clone();
            
            const direction = new THREE.Vector3()
                .subVectors(targetPosition, ufoPosition)
                .normalize();
            
            ufo.position.add(direction.multiplyScalar(0.4));
            ufo.lookAt(camera.position);
            
            ufo.userData.light.intensity = 2 + Math.sin(Date.now() * 0.02) * 1;
            
            if (ufo.position.distanceTo(targetPosition) < 3) {
                activateTractorBeam();
                return;
            }
            
            if (ufoActive) {
                requestAnimationFrame(animateUFO);
            }
        }

        function activateTractorBeam() {
            const tractorBeam = ufo.userData.tractorBeam;
            tractorBeam.material.opacity = 0.4;
            
            let beamProgress = 0;
            const beamAnimation = () => {
                beamProgress += 0.04;
                tractorBeam.scale.y = beamProgress;
                
                if (beamProgress >= 1.5) {
                    stealMessage();
                    return;
                }
                
                if (ufoActive) {
                    requestAnimationFrame(beamAnimation);
                }
            };
            
            beamAnimation();
        }
        function stealMessage() {
            const message = ufoTargetMessage.mesh;
            const ufoPosition = ufo.position.clone();
            
            ufo.userData.stolenMessage = message;
            
            const liftAnimation = () => {
                message.position.lerp(ufoPosition, 0.1);
                message.scale.multiplyScalar(0.92);
                message.rotation.y += 0.3;
                
                if (message.position.distanceTo(ufoPosition) < 1 || message.scale.x < 0.05) {
                    scene.remove(message);
                    const messageIndex = messageObjects.indexOf(ufoTargetMessage);
                    if (messageIndex > -1) {
                        messageObjects.splice(messageIndex, 1);
                    }
                    moveToCamera();
                    return;
                }
                
                if (ufoActive) {
                    requestAnimationFrame(liftAnimation);
                }
            };
            
            liftAnimation();
        }

        function moveToCamera() {
            const cameraFront = new THREE.Vector3();
            camera.getWorldDirection(cameraFront);
            const targetPosition = camera.position.clone().add(cameraFront.multiplyScalar(8));
            targetPosition.y += 2;
            
            const flyToCamera = () => {
                const direction = new THREE.Vector3()
                    .subVectors(targetPosition, ufo.position)
                    .normalize();
                
                ufo.position.add(direction.multiplyScalar(0.6));
                ufo.lookAt(camera.position);
                
                if (ufo.position.distanceTo(targetPosition) < 1) {
                    showStolenMessage();
                    return;
                }
                
                if (ufoActive) {
                    requestAnimationFrame(flyToCamera);
                }
            };
            
            flyToCamera();
        }
        function moveUFOToScreen() {
            const screenPosition = new THREE.Vector3(0, 5, 15);
            
            const flyAway = () => {
                const direction = new THREE.Vector3()
                    .subVectors(screenPosition, ufo.position)
                    .normalize();
                
                ufo.position.add(direction.multiplyScalar(0.5));
                ufo.userData.light.intensity = 1 + Math.sin(Date.now() * 0.02) * 2;
                
                if (ufo.position.distanceTo(screenPosition) < 2) {
                    showStolenMessage();
                    return;
                }
                
                if (ufoActive) {
                    requestAnimationFrame(flyAway);
                }
            };
            
            flyAway();
        }

        function showStolenMessage() {
            const stolenMessage = ufoTargetMessage.mesh.clone();
            stolenMessage.scale.set(0.5, 0.5, 0.5);
            stolenMessage.position.copy(ufo.position);
            stolenMessage.position.y -= 3;
            scene.add(stolenMessage);
            
            ufo.userData.light.intensity = 8;
            
            setTimeout(() => {
                scene.remove(stolenMessage);
                ufoActive = false;
                scene.remove(ufo);
                resetUFO();
            }, 3000);
        }
        function resetUFO() {
            setTimeout(() => {
                if (messageObjects.length > 0) {
                    startUFOMission();
                }
            }, 10000);
        }
        function create3DHearts() {
            for (let i = 0; i < 10; i++) {
                const heartGeometry = new THREE.SphereGeometry(0.15, 8, 8);
                const heartMaterial = new THREE.MeshPhongMaterial({ color: 0xff69b4, emissive: 0x990044 });
                
                const heart = new THREE.Mesh(heartGeometry, heartMaterial);
                heart.position.set((Math.random() - 0.5) * 20, 10 + Math.random() * 5, (Math.random() - 0.5) * 20);
                
                scene.add(heart);
                animate3DHeart(heart);
            }
        }
        
        function animate3DHeart(heart) {
            const fallSpeed = Math.random() * 0.05 + 0.02;
            const rotateSpeed = Math.random() * 0.1 + 0.05;
            
            function animate() {
                heart.position.y -= fallSpeed;
                heart.rotation.x += rotateSpeed;
                heart.rotation.z += rotateSpeed;
                
                if (heart.position.y > -10) {
                    requestAnimationFrame(animate);
                } else {
                    scene.remove(heart);
                }
            }
            
            animate();
        }
        
        function openModal(e) {
            const index = parseInt(e.currentTarget.getAttribute('data-index'));
            const modal = document.getElementById('image-modal');
            const modalImage = document.getElementById('modal-image');
            const modalMessage = document.getElementById('modal-message');
            
            modalImage.src = e.currentTarget.querySelector('img').src;
            modalMessage.textContent = imageMessages[index];
            
            modal.style.display = 'flex';
        }
        
        function closeModal() {
            document.getElementById('image-modal').style.display = 'none';
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            saturn.rotation.y += 0.001;
            
            ringTextObjects.forEach((obj, i) => {
                obj.rotation.y += 0.001;
                obj.position.y = Math.sin(Date.now() * 0.001 + i * 0.1) * 0.2;
                
                // Hacer que cada letra mire hacia la cámara
                obj.lookAt(camera.position);
            });
            
            const time = Date.now() * 0.001;
            
            messageObjects.forEach((obj, i) => {
                obj.mesh.position.y = obj.originalY + Math.sin(time * obj.speed + i) * 1.5;
                obj.angle += 0.001 * obj.speed;
                obj.mesh.position.x = Math.cos(obj.angle) * obj.distance;
                obj.mesh.position.z = Math.sin(obj.angle) * obj.distance;
                
                obj.mesh.lookAt(camera.position);
            });
            
            controls.update();
            renderer.render(scene, camera);
        }
        
        loadResources().then(() => {
            createCSSStars(150);
            init();
        });
    </script>
</body>
</html>